<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bookshelf | Giovanni Lupo</title>
  <style>
    :root {
      --pad: 20px;
      --hover-color: #6a2548;
      --base-color: #000;
    }
    
    @font-face {
      font-family: "GioCustom";
      src: url("../acidic.woff2") format("woff2"),
           url("../acidic.ttf")   format("truetype");
      font-weight: 400 900;
      font-style: normal;
      font-display: swap;
    }

    html, body { margin: 0; min-height: 100%; }
    *, *::before, *::after { box-sizing: border-box; }

    body {
      font-family: "GioCustom", "New Century Schoolbook", "TeX Gyre Schola", serif;
      background: #fff;
      color: #000;
      padding: var(--pad);
    }

    /* Header */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 40px;
      flex-wrap: wrap;
      gap: 16px;
    }

    h1 {
      font-size: clamp(24px, 4vw, 42px);
      font-weight: 800;
      margin: 0;
    }

    nav {
      display: flex;
      gap: 20px;
      font-size: 1em;
    }

    nav a {
      color: var(--base-color);
      text-decoration: none;
      transition: color 200ms ease;
    }
    nav a:hover { color: var(--hover-color); }

    /* Filter tabs */
    .filters {
      display: flex;
      gap: 16px;
      margin-bottom: 32px;
      flex-wrap: wrap;
    }

    .filter-btn {
      background: none;
      border: 2px solid var(--base-color);
      padding: 8px 16px;
      font-family: inherit;
      font-size: 0.9em;
      cursor: pointer;
      transition: all 200ms ease;
    }
    .filter-btn:hover,
    .filter-btn.active {
      background: var(--hover-color);
      border-color: var(--hover-color);
      color: #fff;
    }

    /* Year sections */
    .year-section {
      margin-bottom: 48px;
    }

    .year-header {
      font-size: 1.8em;
      font-weight: 800;
      margin-bottom: 24px;
      padding-bottom: 8px;
      border-bottom: 2px solid var(--base-color);
    }

    /* Book grid */
    .books-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 32px;
      margin-bottom: 32px;
    }

    .book {
      display: flex;
      flex-direction: column;
      opacity: 0;
      animation: fadeIn 600ms ease forwards;
    }

    .book-cover {
      width: 100%;
      aspect-ratio: 2/3;
      object-fit: cover;
      background: #f0f0f0;
      border: 1px solid #ddd;
      transition: transform 200ms ease, box-shadow 200ms ease;
    }
    .book:hover .book-cover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }

    .book-info {
      margin-top: 12px;
    }

    .book-title {
      font-weight: 700;
      font-size: 0.95em;
      line-height: 1.3;
      margin-bottom: 4px;
    }

    .book-author {
      font-size: 0.85em;
      opacity: 0.7;
    }

    .book-rating {
      margin-top: 6px;
      font-size: 0.8em;
      color: var(--hover-color);
    }

    .book-status {
      display: inline-block;
      font-size: 0.7em;
      padding: 2px 8px;
      margin-top: 6px;
      background: #f5f5f5;
      border-radius: 2px;
    }
    .book-status.reading { background: #e8f5e9; color: #2e7d32; }
    .book-status.finished { background: #e3f2fd; color: #1565c0; }
    .book-status.want-to-read { background: #fff3e0; color: #e65100; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      opacity: 0.6;
    }

    @media (prefers-reduced-motion: reduce) {
      .book { animation: none; opacity: 1; }
      .book-cover { transition: none; }
    }
    
    ::-webkit-scrollbar {
      width: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f0f0f0;
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--hover-color);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #5a1d38;
    }
  </style>
</head>
<body>
  <header>
    <h1>Bookshelf</h1>
    <nav>
      <a href="../">Home</a>
      <a href="../movies/">Letterboxd</a>
      <a href="../projects/">Project Blog</a>
      <a href="../about/">About Me</a>
      
    </nav>
  </header>

  <div class="filters">
    <button class="filter-btn active" data-filter="all">All</button>
    <button class="filter-btn" data-filter="reading">Reading</button>
    <button class="filter-btn" data-filter="finished">Finished</button>
    <button class="filter-btn" data-filter="want-to-read">Want to Read</button>
  </div>

  <div id="books-container"></div>
  <div class="empty-state" id="empty-state" style="display:none;">I have never read a book ever. It's totally not that I messed up the json.</div>

  <script>
    // Use large covers from Open Library
    const OPEN_LIBRARY_COVER = (isbn) => `https://covers.openlibrary.org/b/isbn/${isbn}-L.jpg`;

    let allBooks = [];
    let currentFilter = 'all';

    async function loadBooks() {
      try {
        const res = await fetch('books.json');
        allBooks = await res.json();
        renderBooks();
      } catch (e) {
        console.error('Failed to load books:', e);
        document.getElementById('empty-state').style.display = 'block';
      }
    }

    function renderBooks() {
      const container = document.getElementById('books-container');
      const empty = document.getElementById('empty-state');
      
      const filtered = currentFilter === 'all' 
        ? allBooks 
        : allBooks.filter(b => b.status === currentFilter);

      if (filtered.length === 0) {
        container.innerHTML = '';
        empty.style.display = 'block';
        return;
      }

      empty.style.display = 'none';

      // Group finished books by year, keep others ungrouped
      const finishedByYear = {};
      const currentlyReading = [];
      const wantToRead = [];

      filtered.forEach(book => {
        if (book.status === 'finished' && book.yearRead) {
          if (!finishedByYear[book.yearRead]) {
            finishedByYear[book.yearRead] = [];
          }
          finishedByYear[book.yearRead].push(book);
        } else if (book.status === 'reading') {
          currentlyReading.push(book);
        } else if (book.status === 'want-to-read') {
          wantToRead.push(book);
        } else if (book.status === 'finished') {
          // Finished books without year
          if (!finishedByYear['Unknown']) {
            finishedByYear['Unknown'] = [];
          }
          finishedByYear['Unknown'].push(book);
        }
      });

      let html = '';
      let animationDelay = 0;

      // Currently Reading
      if (currentlyReading.length > 0) {
        html += '<div class="year-section"><h2 class="year-header">Currently Reading</h2><div class="books-grid">';
        currentlyReading.forEach(book => {
          html += renderBook(book, animationDelay);
          animationDelay += 50;
        });
        html += '</div></div>';
      }

      // Finished by Year (newest first)
      const years = Object.keys(finishedByYear).sort((a, b) => {
        if (a === 'Unknown') return 1;
        if (b === 'Unknown') return -1;
        return b - a;
      });

      years.forEach(year => {
        html += `<div class="year-section"><h2 class="year-header">${year}</h2><div class="books-grid">`;
        finishedByYear[year].forEach(book => {
          html += renderBook(book, animationDelay);
          animationDelay += 50;
        });
        html += '</div></div>';
      });

      // Want to Read
      if (wantToRead.length > 0) {
        html += '<div class="year-section"><h2 class="year-header">Want to Read</h2><div class="books-grid">';
        wantToRead.forEach(book => {
          html += renderBook(book, animationDelay);
          animationDelay += 50;
        });
        html += '</div></div>';
      }

      container.innerHTML = html;
    }

    function renderBook(book, delay) {
      const cover = book.cover || (book.isbn ? OPEN_LIBRARY_COVER(book.isbn) : '');
      const stars = book.rating ? '★'.repeat(book.rating) + '☆'.repeat(5 - book.rating) : '';
      const statusLabel = book.status?.replace(/-/g, ' ') || '';
      
      return `
        <div class="book" style="animation-delay: ${delay}ms">
          <img 
            class="book-cover" 
            src="${cover}" 
            alt="${book.title}"
            onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 2 3%22><rect fill=%22%23f0f0f0%22 width=%222%22 height=%223%22/><text x=%221%22 y=%221.8%22 font-size=%22.3%22 text-anchor=%22middle%22 fill=%22%23999%22>No Cover</text></svg>'"
          >
          <div class="book-info">
            <div class="book-title">${book.title}</div>
            <div class="book-author">${book.author}</div>
            ${stars ? `<div class="book-rating">${stars}</div>` : ''}
          </div>
        </div>
      `;
    }

    // Filter buttons
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelector('.filter-btn.active').classList.remove('active');
        btn.classList.add('active');
        currentFilter = btn.dataset.filter;
        renderBooks();
      });
    });

    loadBooks();
  </script>
</body>
</html>
